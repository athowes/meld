<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Markov Melding | Markov Melding Notes</title>
  <meta name="description" content="3 Markov Melding | Markov Melding Notes" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Markov Melding | Markov Melding Notes" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Markov Melding | Markov Melding Notes" />
  
  
  

<meta name="author" content="Adam Howes" />


<meta name="date" content="2019-07-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="background.html">
<link rel="next" href="divide-and-conquer-with-smc.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Notation</a></li>
<li class="chapter" data-level="2" data-path="background.html"><a href="background.html"><i class="fa fa-check"></i><b>2</b> Background</a><ul>
<li class="chapter" data-level="2.1" data-path="background.html"><a href="background.html#monte-carlo"><i class="fa fa-check"></i><b>2.1</b> Monte Carlo</a><ul>
<li class="chapter" data-level="2.1.1" data-path="background.html"><a href="background.html#metropolis-hastings-sampler"><i class="fa fa-check"></i><b>2.1.1</b> Metropolis-Hastings sampler</a></li>
<li class="chapter" data-level="2.1.2" data-path="background.html"><a href="background.html#random-scan-gibbs-sampler"><i class="fa fa-check"></i><b>2.1.2</b> (Random scan) Gibbs sampler</a></li>
<li class="chapter" data-level="2.1.3" data-path="background.html"><a href="background.html#random-scan-metropolis-within-gibbs"><i class="fa fa-check"></i><b>2.1.3</b> (Random scan) Metropolis-within-Gibbs</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="background.html"><a href="background.html#meta-analysis-evidence-synthesis-combining-expert-opinion-etc."><i class="fa fa-check"></i><b>2.2</b> Meta-analysis, evidence synthesis, combining expert opinion etc.</a><ul>
<li class="chapter" data-level="2.2.1" data-path="background.html"><a href="background.html#multiple-experts"><i class="fa fa-check"></i><b>2.2.1</b> Multiple Experts</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="background.html"><a href="background.html#graphical-models"><i class="fa fa-check"></i><b>2.3</b> Graphical models</a><ul>
<li class="chapter" data-level="2.3.1" data-path="background.html"><a href="background.html#bayesian-networks"><i class="fa fa-check"></i><b>2.3.1</b> Bayesian networks</a></li>
<li class="chapter" data-level="2.3.2" data-path="background.html"><a href="background.html#factor-graphs"><i class="fa fa-check"></i><b>2.3.2</b> Factor graphs</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="background.html"><a href="background.html#miscellaneous-reading"><i class="fa fa-check"></i><b>2.4</b> Miscellaneous reading</a><ul>
<li class="chapter" data-level="2.4.1" data-path="background.html"><a href="background.html#bayesian-approaches-to-random-effects-meta-analysis"><i class="fa fa-check"></i><b>2.4.1</b> Bayesian approaches to random-effects meta-analysis</a></li>
<li class="chapter" data-level="2.4.2" data-path="background.html"><a href="background.html#the-statistical-basis-of-meta-analysis"><i class="fa fa-check"></i><b>2.4.2</b> The statistical basis of meta-analysis</a></li>
<li class="chapter" data-level="2.4.3" data-path="background.html"><a href="background.html#bayesian-calibration-of-computer-models"><i class="fa fa-check"></i><b>2.4.3</b> Bayesian calibration of computer models</a></li>
<li class="chapter" data-level="2.4.4" data-path="background.html"><a href="background.html#inference-for-deterministic-simulation-models-the-bayesian-melding-approach"><i class="fa fa-check"></i><b>2.4.4</b> Inference for deterministic simulation models: the Bayesian melding approach</a></li>
<li class="chapter" data-level="2.4.5" data-path="background.html"><a href="background.html#combining-models"><i class="fa fa-check"></i><b>2.4.5</b> Combining Models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="markov-melding.html"><a href="markov-melding.html"><i class="fa fa-check"></i><b>3</b> Markov Melding</a><ul>
<li class="chapter" data-level="3.1" data-path="markov-melding.html"><a href="markov-melding.html#introduction-to-markov-melding"><i class="fa fa-check"></i><b>3.1</b> Introduction to Markov melding</a></li>
<li class="chapter" data-level="3.2" data-path="markov-melding.html"><a href="markov-melding.html#markov-combination"><i class="fa fa-check"></i><b>3.2</b> Markov combination</a></li>
<li class="chapter" data-level="3.3" data-path="markov-melding.html"><a href="markov-melding.html#pooling-marginal-distributions"><i class="fa fa-check"></i><b>3.3</b> Pooling marginal distributions</a></li>
<li class="chapter" data-level="3.4" data-path="markov-melding.html"><a href="markov-melding.html#inference-and-computation"><i class="fa fa-check"></i><b>3.4</b> Inference and computation</a><ul>
<li class="chapter" data-level="3.4.1" data-path="markov-melding.html"><a href="markov-melding.html#metropolis-within-gibbs"><i class="fa fa-check"></i><b>3.4.1</b> Metropolis-within-Gibbs</a></li>
<li class="chapter" data-level="3.4.2" data-path="markov-melding.html"><a href="markov-melding.html#multi-stage-metropolis-within-gibbs"><i class="fa fa-check"></i><b>3.4.2</b> Multi-stage Metropolis-within-Gibbs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="divide-and-conquer-with-smc.html"><a href="divide-and-conquer-with-smc.html"><i class="fa fa-check"></i><b>4</b> Divide and Conquer with SMC</a></li>
<li class="chapter" data-level="5" data-path="gambia-malaria-data.html"><a href="gambia-malaria-data.html"><i class="fa fa-check"></i><b>5</b> Gambia Malaria Data</a><ul>
<li class="chapter" data-level="5.1" data-path="gambia-malaria-data.html"><a href="gambia-malaria-data.html#logistic-regression"><i class="fa fa-check"></i><b>5.1</b> Logistic regression</a></li>
<li class="chapter" data-level="5.2" data-path="gambia-malaria-data.html"><a href="gambia-malaria-data.html#full-and-submodels"><i class="fa fa-check"></i><b>5.2</b> Full and submodels</a></li>
<li class="chapter" data-level="5.3" data-path="gambia-malaria-data.html"><a href="gambia-malaria-data.html#monte-carlo-schemes"><i class="fa fa-check"></i><b>5.3</b> Monte Carlo schemes</a><ul>
<li class="chapter" data-level="5.3.1" data-path="gambia-malaria-data.html"><a href="gambia-malaria-data.html#metropolis-within-gibbs-1"><i class="fa fa-check"></i><b>5.3.1</b> Metropolis-within-Gibbs</a></li>
<li class="chapter" data-level="5.3.2" data-path="gambia-malaria-data.html"><a href="gambia-malaria-data.html#multi-stage-metropolis-within-gibbs-1"><i class="fa fa-check"></i><b>5.3.2</b> Multi-stage Metropolis-within-Gibbs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>6</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Markov Melding Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="markov-melding" class="section level1">
<h1><span class="header-section-number">3</span> Markov Melding</h1>
<p>Notes from <span class="citation">(Goudie et al. <a href="#ref-goudie2019joining">2019</a>)</span>.</p>
<div id="introduction-to-markov-melding" class="section level2">
<h2><span class="header-section-number">3.1</span> Introduction to Markov melding</h2>
<ul>
<li>Motivation: by using all available data typically get:
<ul>
<li>More precise estimates</li>
<li>More accurate reflection of true uncertainty</li>
<li>Minimise risk of selection-type biases</li>
</ul></li>
<li>Modular approaches
<ol style="list-style-type: decimal">
<li>Plug in a point estimate
<ul>
<li>Very easy and fast</li>
<li>Underestimates uncertainty</li>
</ul></li>
<li>Plug in an approximation to the posterior
<ul>
<li>Quite easy and fast</li>
<li>Assumptions made can be unclear</li>
</ul></li>
<li>Integrate the models
<ul>
<li>All uncertainty propagated</li>
<li>All assumptions explicit</li>
<li>Probably tricky to do</li>
</ul></li>
</ol></li>
<li>Aims of work:
<ol style="list-style-type: decimal">
<li>Join submodels <span class="math inline">\(p_m\)</span> into a single joint model
<ul>
<li>Must implicitly handle two different priors for same quantity</li>
<li>Must handle non-invertible deterministic transformations</li>
</ul></li>
<li>Fit the submodels one at a time
<ul>
<li>Minimize burden on practitioners</li>
</ul></li>
<li>Understanding of reverse operation to joining - splitting</li>
</ol></li>
<li>Models <span class="math inline">\(m = 1, \ldots, M\)</span> each with joint density <span class="math inline">\(p_m(\phi, \psi_m, Y_m)\)</span> where:
<ul>
<li><span class="math inline">\(\phi\)</span> is the common parameter linking the models</li>
<li><span class="math inline">\(\psi_m\)</span> are model specific unobserved parameters</li>
<li><span class="math inline">\(Y_m\)</span> are model specific observed quantities</li>
</ul></li>
<li>Join together to create <span class="math inline">\(p(\phi, \psi_1, \ldots, \psi_M, Y_1, \ldots, Y_M)\)</span></li>
</ul>
</div>
<div id="markov-combination" class="section level2">
<h2><span class="header-section-number">3.2</span> Markov combination</h2>
<p>Goudie cites <span class="citation">(Dawid, Lauritzen, and others <a href="#ref-dawid1993hyper">1993</a>)</span> and <span class="citation">(Massa and Lauritzen <a href="#ref-massa2010combining">2010</a>)</span>. <em>To-do: look more into these</em></p>
<p>Suppose that the marginals are consistent i.e. <span class="math inline">\(p_m(\phi) = p(\phi)\)</span> for all <span class="math inline">\(m\)</span> then one can define the Markov combination <span class="math inline">\(p_\text{comb}\)</span> of submodels <span class="math inline">\(p_1, \ldots, p_m\)</span> as</p>
<span class="math display">\[\begin{align*}
p_{\mathrm{comb}}\left(\phi, \psi_1, \ldots, \psi_M, Y_1, \ldots, Y_M\right) &amp;= p(\phi) \prod_{m=1}^{M} p_m\left(\psi_m, Y_m | \phi\right) \\
&amp;= p(\phi) \prod_{m=1}^{M} \frac{p_m\left(\phi, \psi_m, Y_m\right)}{p(\phi)} \\
&amp;= \frac{\prod_{m=1}^{M} p_m\left(\phi, \psi_m, Y_m\right)}{p(\phi)^{M-1}}
\end{align*}\]</span>
</div>
<div id="pooling-marginal-distributions" class="section level2">
<h2><span class="header-section-number">3.3</span> Pooling marginal distributions</h2>
If the marginals are inconsistent then instead a pooled density <span class="math inline">\(p_\text{pool}(\phi) = g(p_1(\phi), \ldots, p_M(\phi))\)</span> can be used instead. Similar idea to combining expert opinions. This suggests the joint model
<span class="math display">\[\begin{align*}
p_{\text{meld}}\left(\phi, \psi_{1}, \ldots, \psi_{M}, Y_{1}, \ldots, Y_{M}\right) &amp;= p_{\text{pool}}(\phi) \prod_{m=1}^{M} p_{m}\left(\psi_{m}, Y_{m} | \phi\right) \\
&amp;= p_{\text{pool}}(\phi) \prod_{m=1}^{M} \frac{p_{m}\left(\phi, \psi_{m}, Y_{m}\right)}{p_m(\phi)}
\end{align*}\]</span>
<p>Goudie calls this Markov melding.</p>
</div>
<div id="inference-and-computation" class="section level2">
<h2><span class="header-section-number">3.4</span> Inference and computation</h2>
<p>Joint posterior, given data <span class="math inline">\(Y_m = y_m\)</span> for <span class="math inline">\(m = 1, \ldots, M\)</span>, under Melded model is <span class="math display">\[
p_{\text{meld}}(\phi, \psi_{1}, \ldots, \psi_{M} | y_{1}, \ldots, y_{M}) \propto p_{\text{pool}}(\phi) \prod_{m=1}^{M} \frac{p_{m}\left(\phi, \psi_{m}, y_{m}\right)}{p_{m}(\phi)}
\]</span></p>
<p>Metropolis-Hastings candidate values <span class="math inline">\((\phi^{\star}, \psi_{1}^{\star}, \ldots, \psi_{M}^{\star})\)</span> drawn from a proposal <span class="math inline">\(q(\phi^{\star}, \psi_{1}^{\star}, \ldots, \psi_{M}^{\star} | \phi, \psi_{1}, \ldots, \psi_{M})\)</span> and accepted with probability <span class="math inline">\(\text{min}(1, r)\)</span> where <span class="math display">\[
r=\frac{R\left(\phi^{\star}, \psi_{1}^{\star}, \ldots, \psi_{M}^{\star}, \phi, \psi_{1}, \ldots, \psi_{M}\right)}
         {R\left(\phi, \psi_{1}, \ldots, \psi_{M}, \phi^{\star}, \psi_{1}^{\star}, \ldots, \psi_{M}^{\star}\right)}
\]</span></p>
<p>where <span class="math inline">\(R\left(\phi^{\star}, \psi_{1}^{\star}, \ldots, \psi_{M}^{\star}, \phi, \psi_{1}, \ldots, \psi_{M}\right)\)</span> is the target-to-proposal density ratio <span class="math display">\[
R\left(\phi^{\star}, \psi_{1}^{\star}, \ldots, \psi_{M}^{\star}, \phi, \psi_{1}, \ldots, \psi_{M}\right) = p_{\mathrm{pool}}\left(\phi^{\star}\right) \prod_{m=1}^{M} \frac{p_{m}\left(\phi^{\star}, \psi_{m}^{\star}, y_{m}\right)}{p_{m}\left(\phi^{\star}\right)} \times \frac{1}{q\left(\phi^{\star}, \psi_{1}^{\star}, \ldots, \psi_{M}^{\star} | \phi, \psi_{1}, \ldots, \psi_{M}\right)}
\]</span></p>
<div id="metropolis-within-gibbs" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Metropolis-within-Gibbs</h3>
<p>Sample from the full conditionals using Metropolis-Hastings.</p>
<p>For each of the latent parameter updates (<span class="math inline">\(\psi_m\)</span> for <span class="math inline">\(m=1,\ldots,M\)</span>) we have <span class="math display">\[
R\left(\phi, \psi_{1}, \ldots, \psi_{m}^{\star}, \ldots, \psi_{M}, \phi, \psi_{1}, \ldots, \psi_{M}\right) = p_{\mathrm{pool}}\left(\phi\right) \prod_{j\neq m} \frac{p_{j}\left(\phi, \psi_{j}, y_{j}\right)}{p_{j}\left(\phi\right)} \times \frac{p_{m}\left(\phi, \psi_{m}^{\star}, y_{m}\right)}{p_{m}\left(\phi\right)} \frac{1}{q\left(\psi_{m}^{\star} | \psi_{m}\right)}
\]</span></p>
<p>so that <span class="math display">\[
r = \frac{p_{m}\left(\phi, \psi_{m}^{\star}, y_{m}\right) \times \frac{1}{q\left(\psi_{m}^{\star} | \psi_{m}\right)}}{p_{m}\left(\phi, \psi_{m}, y_{m}\right) \times \frac{1}{q\left(\psi_{m} | \psi_{m}^{\star}\right)}}
\]</span></p>
<p>and for the link parameter update <span class="math display">\[
R\left(\phi, \psi_{1}, \ldots, \psi_{m}^{\star}, \ldots, \psi_{M}, \phi, \psi_{1}, \ldots, \psi_{M}\right) = p_{\mathrm{pool}}\left(\phi^{\star}\right) \prod_{m=1}^{M} \frac{p_{m}\left(\phi^{\star}, \psi_{m}, y_{m}\right)}{p_{m}\left(\phi^{\star}\right)} \times \frac{1}{q\left(\phi^{\star} | \phi\right)}
\]</span></p>
</div>
<div id="multi-stage-metropolis-within-gibbs" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Multi-stage Metropolis-within-Gibbs</h3>
<p>Factorise the pooled prior (can be done in many ways) <span class="math display">\[
p_{\text{pool}}(\phi) = \prod_{m=1}^{M} p_{\text{pool,}m}(\phi)
\]</span></p>
<p>Define <span class="math inline">\(l\)</span>th stage posterior as <span class="math display">\[
p_{\text {meld,}l}\left(\phi, \psi_{1}, \ldots, \psi_{\ell} | y_{1}, \ldots, y_{\ell}\right) \propto \prod_{m=1}^{\ell}\left(\frac{p_{m}\left(\phi, \psi_{m}, y_{m}\right)}{p_{m}(\phi)} p_{\mathrm{pool}, m}(\phi)\right)
\]</span> <strong>Basis</strong> obtain samples <span class="math inline">\(\left(\phi^{(h, 1)}, \psi_{1}^{(h, 1)}\right)\)</span> for <span class="math inline">\(h=1, \ldots, H_{1}\)</span> from <span class="math inline">\(p_{\text {meld,}1}\left(\phi, \psi_{1} | y_{1}\right)\)</span> (by MCMC typically)</p>
<p><strong>Inductive</strong> construct a Metropolis-within-Gibbs sampler for <span class="math inline">\(\left(\phi, \psi_{1}, \ldots, \psi_{\ell}\right)\)</span> given the data <span class="math inline">\(\left(y_{1}, \ldots, y_{\ell}\right)\)</span></p>

</div>
</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-dawid1993hyper">
<p>Dawid, A Philip, Steffen L Lauritzen, and others. 1993. “Hyper Markov Laws in the Statistical Analysis of Decomposable Graphical Models.” <em>The Annals of Statistics</em> 21 (3). Institute of Mathematical Statistics: 1272–1317.</p>
</div>
<div id="ref-goudie2019joining">
<p>Goudie, Robert JB, Anne M Presanis, David Lunn, Daniela De Angelis, and Lorenz Wernisch. 2019. “Joining and Splitting Models with Markov Melding.” <em>Bayesian Analysis</em> 14 (1). Europe PMC Funders: 81.</p>
</div>
<div id="ref-massa2010combining">
<p>Massa, M Sofia, and Steffen L Lauritzen. 2010. “Combining Statistical Models.” <em>Contemporary Mathematics: Algebraic Methods in Statistics and Probability II</em>, 239–60.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="background.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="divide-and-conquer-with-smc.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["melding_notes.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
